import{aB as Q,aC as b,K as I,aD as K,aE as q,aF as P,aG as Y,aH as M,aI as $,aJ as F,aK as k,x as U,r as h,c as T,w as V,o as j,J as G,h as E,z as J,a2 as N,Y as W,aL as Z,g as ee,N as te,L as oe}from"./index.628e6afe.js";import{g as O,s as X}from"./touch.70a9dd44.js";import{c as re}from"./selection.e42c4336.js";import{b as ne}from"./format.2a3572e1.js";function B(i,n,a){const u=$(i);let e,t=u.left-n.event.x,o=u.top-n.event.y,s=Math.abs(t),l=Math.abs(o);const r=n.direction;r.horizontal===!0&&r.vertical!==!0?e=t<0?"left":"right":r.horizontal!==!0&&r.vertical===!0?e=o<0?"up":"down":r.up===!0&&o<0?(e="up",s>l&&(r.left===!0&&t<0?e="left":r.right===!0&&t>0&&(e="right"))):r.down===!0&&o>0?(e="down",s>l&&(r.left===!0&&t<0?e="left":r.right===!0&&t>0&&(e="right"))):r.left===!0&&t<0?(e="left",s<l&&(r.up===!0&&o<0?e="up":r.down===!0&&o>0&&(e="down"))):r.right===!0&&t>0&&(e="right",s<l&&(r.up===!0&&o<0?e="up":r.down===!0&&o>0&&(e="down")));let p=!1;if(e===void 0&&a===!1){if(n.event.isFirst===!0||n.event.lastDir===void 0)return{};e=n.event.lastDir,p=!0,e==="left"||e==="right"?(u.left-=t,s=0,t=0):(u.top-=o,l=0,o=0)}return{synthetic:p,payload:{evt:i,touch:n.event.mouse!==!0,mouse:n.event.mouse===!0,position:u,direction:e,isFirst:n.event.isFirst,isFinal:a===!0,duration:Date.now()-n.event.time,distance:{x:s,y:l},offset:{x:t,y:o},delta:{x:u.left-n.event.lastX,y:u.top-n.event.lastY}}}}let ie=0;var se=Q({name:"touch-pan",beforeMount(i,{value:n,modifiers:a}){if(a.mouse!==!0&&b.has.touch!==!0)return;function u(t,o){a.mouse===!0&&o===!0?k(t):(a.stop===!0&&M(t),a.prevent===!0&&Y(t))}const e={uid:"qvtp_"+ie++,handler:n,modifiers:a,direction:O(a),noop:I,mouseStart(t){X(t,e)&&K(t)&&(q(e,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),e.start(t,!0))},touchStart(t){if(X(t,e)){const o=t.target;q(e,"temp",[[o,"touchmove","move","notPassiveCapture"],[o,"touchcancel","end","passiveCapture"],[o,"touchend","end","passiveCapture"]]),e.start(t)}},start(t,o){if(b.is.firefox===!0&&P(i,!0),e.lastEvt=t,o===!0||a.stop===!0){if(e.direction.all!==!0&&(o!==!0||e.modifiers.mouseAllDir!==!0)){const r=t.type.indexOf("mouse")>-1?new MouseEvent(t.type,t):new TouchEvent(t.type,t);t.defaultPrevented===!0&&Y(r),t.cancelBubble===!0&&M(r),Object.assign(r,{qKeyEvent:t.qKeyEvent,qClickOutside:t.qClickOutside,qAnchorHandled:t.qAnchorHandled,qClonedBy:t.qClonedBy===void 0?[e.uid]:t.qClonedBy.concat(e.uid)}),e.initialEvent={target:t.target,event:r}}M(t)}const{left:s,top:l}=$(t);e.event={x:s,y:l,time:Date.now(),mouse:o===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:s,lastY:l}},move(t){if(e.event===void 0)return;const o=$(t),s=o.left-e.event.x,l=o.top-e.event.y;if(s===0&&l===0)return;e.lastEvt=t;const r=e.event.mouse===!0,p=()=>{u(t,r),a.preserveCursor!==!0&&(document.documentElement.style.cursor="grabbing"),r===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),re(),e.styleCleanup=c=>{if(e.styleCleanup=void 0,a.preserveCursor!==!0&&(document.documentElement.style.cursor=""),document.body.classList.remove("non-selectable"),r===!0){const m=()=>{document.body.classList.remove("no-pointer-events--children")};c!==void 0?setTimeout(()=>{m(),c()},50):m()}else c!==void 0&&c()}};if(e.event.detected===!0){e.event.isFirst!==!0&&u(t,e.event.mouse);const{payload:c,synthetic:m}=B(t,e,!1);c!==void 0&&(e.handler(c)===!1?e.end(t):(e.styleCleanup===void 0&&e.event.isFirst===!0&&p(),e.event.lastX=c.position.left,e.event.lastY=c.position.top,e.event.lastDir=m===!0?void 0:c.direction,e.event.isFirst=!1));return}if(e.direction.all===!0||r===!0&&e.modifiers.mouseAllDir===!0){p(),e.event.detected=!0,e.move(t);return}const f=Math.abs(s),v=Math.abs(l);f!==v&&(e.direction.horizontal===!0&&f>v||e.direction.vertical===!0&&f<v||e.direction.up===!0&&f<v&&l<0||e.direction.down===!0&&f<v&&l>0||e.direction.left===!0&&f>v&&s<0||e.direction.right===!0&&f>v&&s>0?(e.event.detected=!0,e.move(t)):e.end(t,!0))},end(t,o){if(e.event!==void 0){if(F(e,"temp"),b.is.firefox===!0&&P(i,!1),o===!0)e.styleCleanup!==void 0&&e.styleCleanup(),e.event.detected!==!0&&e.initialEvent!==void 0&&e.initialEvent.target.dispatchEvent(e.initialEvent.event);else if(e.event.detected===!0){e.event.isFirst===!0&&e.handler(B(t===void 0?e.lastEvt:t,e).payload);const{payload:s}=B(t===void 0?e.lastEvt:t,e,!0),l=()=>{e.handler(s)};e.styleCleanup!==void 0?e.styleCleanup(l):l()}e.event=void 0,e.initialEvent=void 0,e.lastEvt=void 0}}};i.__qtouchpan=e,a.mouse===!0&&q(e,"main",[[i,"mousedown","mouseStart",`passive${a.mouseCapture===!0?"Capture":""}`]]),b.has.touch===!0&&q(e,"main",[[i,"touchstart","touchStart",`passive${a.capture===!0?"Capture":""}`],[i,"touchmove","noop","notPassiveCapture"]])},updated(i,n){const a=i.__qtouchpan;a!==void 0&&(n.oldValue!==n.value&&(typeof value!="function"&&a.end(),a.handler=n.value),a.direction=O(n.modifiers))},beforeUnmount(i){const n=i.__qtouchpan;n!==void 0&&(n.event!==void 0&&n.end(),F(n,"main"),F(n,"temp"),b.is.firefox===!0&&P(i,!1),n.styleCleanup!==void 0&&n.styleCleanup(),delete i.__qtouchpan)}});const g=40,D=20;var de=U({name:"QPullToRefresh",props:{color:String,bgColor:String,icon:String,noMouse:Boolean,disable:Boolean,scrollTarget:{default:void 0}},emits:["refresh"],setup(i,{slots:n,emit:a}){const{proxy:u}=ee(),{$q:e}=u,t=h("pull"),o=h(0),s=h(!1),l=h(-g),r=h(!1),p=h({}),f=T(()=>({opacity:o.value,transform:`translateY(${l.value}px) rotate(${o.value*360}deg)`})),v=T(()=>"q-pull-to-refresh__puller row flex-center"+(r.value===!0?" q-pull-to-refresh__puller--animating":"")+(i.bgColor!==void 0?` bg-${i.bgColor}`:""));function c(d){if(d.isFinal===!0){s.value===!0&&(s.value=!1,t.value==="pulled"?(t.value="refreshing",w({pos:D}),L()):t.value==="pull"&&w({pos:-g,ratio:0}));return}if(r.value===!0||t.value==="refreshing")return!1;if(d.isFirst===!0){if(te(z)!==0||d.direction!=="down")return s.value===!0&&(s.value=!1,t.value="pull",w({pos:-g,ratio:0})),!1;s.value=!0;const{top:A,left:H}=S.getBoundingClientRect();p.value={top:A+"px",left:H+"px",width:window.getComputedStyle(S).getPropertyValue("width")}}Y(d.evt);const y=Math.min(140,Math.max(0,d.distance.y));l.value=y-g,o.value=ne(y/(D+g),0,1);const C=l.value>D?"pulled":"pull";t.value!==C&&(t.value=C)}const m=T(()=>{const d={down:!0,mightPrevent:!0};return i.noMouse!==!0&&(d.mouse=!0),[[se,c,void 0,d]]}),R=T(()=>`q-pull-to-refresh__content${s.value===!0?" no-pointer-events":""}`);function L(){a("refresh",()=>{w({pos:-g,ratio:0},()=>{t.value="pull"})})}function w({pos:d,ratio:y},C){r.value=!0,l.value=d,y!==void 0&&(o.value=y),clearTimeout(_),_=setTimeout(()=>{r.value=!1,C&&C()},300)}let S,z,_;function x(){z=oe(S,i.scrollTarget)}return V(()=>i.scrollTarget,x),j(()=>{S=u.$el,x()}),G(()=>{clearTimeout(_)}),Object.assign(u,{trigger:L,updateScrollTarget:x}),()=>{const d=[E("div",{class:R.value},J(n.default)),E("div",{class:"q-pull-to-refresh__puller-container fixed row flex-center no-pointer-events z-top",style:p.value},[E("div",{class:v.value,style:f.value},[t.value!=="refreshing"?E(N,{name:i.icon||e.iconSet.pullToRefresh.icon,color:i.color,size:"32px"}):E(W,{size:"24px",color:i.color})])])];return Z("div",{class:"q-pull-to-refresh"},d,"main",i.disable===!1,()=>m.value)}}});export{de as Q,se as T};
