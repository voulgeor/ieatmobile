import{Q as P}from"./QToolbarTitle.00ffb145.js";import{Q as k}from"./QSpace.665629e1.js";import{_ as S,n as s,q as m,t as u,u as a,k as e,a8 as w,aa as n,V as i,U as h,ae as Q,Q as p,ab as v,ac as q,R as $,S as C,ai as V,aq as A,ar as z,as as f,b0 as g,F as B,ad as I,a9 as L}from"./index.628e6afe.js";import{Q as N}from"./QToolbar.380b4d8f.js";import{Q as T}from"./QForm.44b35dda.js";import{Q as _}from"./QItemLabel.efb8f455.js";import{Q as U}from"./QList.1313d8ab.js";import{u as D}from"./PromoStore.577c70ef.js";const F={name:"PromoList",props:["merchant_id","enabled_voucher"],data(){return{promo_code:"",show_modal:!1,loading_apply:!1,loading:!1}},setup(){return{PromoStore:D()}},updated(){this.promo_code=""},created(){Object.keys(this.PromoStore.data).length<=0?this.PromoStore.loadPromo(this.merchant_id):this.PromoStore.data[this.merchant_id]||this.PromoStore.loadPromo(this.merchant_id)},methods:{showModal(o){this.show_modal=o},usePromo(o){this.loading=!0;const t={cart_uuid:s.getStorage("cart_uuid"),promo_id:o.promo_id,promo_type:o.promo_type};s.applyPromo(t).then(l=>{this.show_modal=!1,this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterApplypromo")}).catch(l=>{s.notify("dark",l,"error",this.$q)}).then(l=>{this.loading=!1})},removePromo(o){this.loading=!0;const t={cart_uuid:s.getStorage("cart_uuid"),promo_id:o.promo_id,promo_type:o.promo_type};s.removePromo(t).then(l=>{this.show_modal=!1,this.promo_selected=[],this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterRemovepromo")}).catch(l=>{s.notify("dark",l,"error",this.$q)}).then(l=>{this.loading=!1})},onApplyPromocode(){this.loading_apply=!0;const o={cart_uuid:s.getStorage("cart_uuid"),promo_code:this.promo_code};s.applyPromoCode(o).then(t=>{this.show_modal=!1,this.promo_code="",this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterApplypromo")}).catch(t=>{s.notify("dark",t,"error",this.$q)}).then(t=>{this.loading_apply=!1})}}},R={class:"row items-center q-col-gutter-sm"},x={class:"col b"},E={class:"col-4"},M={class:"text-weight-bold q-ma-none q-pt-md"};function j(o,t,l,b,d,c){return m(),u(L,{modelValue:d.show_modal,"onUpdate:modelValue":t[2]||(t[2]=r=>d.show_modal=r),position:"bottom"},{default:a(()=>[e(I,null,{default:a(()=>[e(N,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:a(()=>[e(P,{class:w(["text-weight-bold",{"text-white":o.$q.dark.mode,"text-dark":!o.$q.dark.mode}])},{default:a(()=>[n(i(o.$t("Add a promo")),1)]),_:1},8,["class"]),e(k),e(h,{onClick:t[0]||(t[0]=r=>d.show_modal=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),l.enabled_voucher==1?(m(),u(Q,{key:0},{default:a(()=>[e(T,{onSubmit:c.onApplyPromocode},{default:a(()=>[p("div",R,[p("div",x,[e(v,{modelValue:d.promo_code,"onUpdate:modelValue":t[1]||(t[1]=r=>d.promo_code=r),label:o.$t("Enter promo code"),outlined:"","lazy-rules":"","bg-color":o.$q.dark.mode?"grey600":"input","label-color":o.$q.dark.mode?"grey300":"grey",borderless:"",class:"input-borderless"},null,8,["modelValue","label","bg-color","label-color"])]),p("div",E,[e(h,{loading:d.loading_apply,type:"submit",unelevated:"",color:"primary","text-color":"white","no-caps":"",class:"full-width",label:o.$t("Apply"),size:"lg"},null,8,["loading","label"])])])]),_:1},8,["onSubmit"]),p("h6",M,i(o.$t("Available promotions")),1)]),_:1})):q("",!0),e(U,{separator:""},{default:a(()=>[(m(!0),$(B,null,C(b.PromoStore.data[l.merchant_id],r=>V((m(),u(z,{key:r.promo_id,clickable:"",class:"q-mb-sm",onClick:f(y=>c.usePromo(r),["stop"])},{default:a(()=>[e(g,null,{default:a(()=>[e(_,null,{default:a(()=>[n(i(r.title),1)]),_:2},1024),e(_,{caption:"",class:"font11"},{default:a(()=>[n(i(r.sub_title),1)]),_:2},1024),e(_,{caption:"",class:"font11"},{default:a(()=>[n(i(r.valid_to),1)]),_:2},1024)]),_:2},1024),e(g,{side:""},{default:a(()=>[e(h,{onClick:f(y=>c.usePromo(r),["stop"]),loading:d.loading,flat:"",color:o.$q.dark.mode?"secondary":"blue","no-caps":"",label:o.$t("Use now"),dense:"",size:"md"},null,8,["onClick","loading","color","label"])]),_:2},1024)]),_:2},1032,["onClick"])),[[A]])),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Z=S(F,[["render",j]]);export{Z as default};
