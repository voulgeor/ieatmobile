import{Q as P}from"./QToolbarTitle.2f2c97c6.js";import{Q as k}from"./QSpace.72e06727.js";import{_ as S,n as s,q as c,t as _,u as a,k as e,a9 as w,ab as m,X as d,V as u,af as Q,R as n,ac as v,S as q,U as $,aj as C,ar as V,as as A,at as f,b3 as g,F as z,ae as B,aa as I}from"./index.7194caca.js";import{Q as L}from"./QToolbar.6e86fa1d.js";import{Q as T}from"./QForm.0c4e0343.js";import{Q as h}from"./QItemLabel.dda41321.js";import{Q as U}from"./QList.5f4666ff.js";import{u as D}from"./PromoStore.e8ee1749.js";const F={name:"PromoList",props:["merchant_id","enabled_voucher"],data(){return{promo_code:"",show_modal:!1,loading_apply:!1,loading:!1}},setup(){return{PromoStore:D()}},updated(){this.promo_code=""},created(){Object.keys(this.PromoStore.data).length<=0?this.PromoStore.loadPromo(this.merchant_id):this.PromoStore.data[this.merchant_id]||this.PromoStore.loadPromo(this.merchant_id)},methods:{showModal(o){this.show_modal=o},usePromo(o){this.loading=!0;const t={cart_uuid:s.getStorage("cart_uuid"),promo_id:o.promo_id,promo_type:o.promo_type};s.applyPromo(t).then(l=>{this.show_modal=!1,this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterApplypromo")}).catch(l=>{s.notify("dark",l,"error",this.$q)}).then(l=>{this.loading=!1})},removePromo(o){this.loading=!0;const t={cart_uuid:s.getStorage("cart_uuid"),promo_id:o.promo_id,promo_type:o.promo_type};s.removePromo(t).then(l=>{this.show_modal=!1,this.promo_selected=[],this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterRemovepromo")}).catch(l=>{s.notify("dark",l,"error",this.$q)}).then(l=>{this.loading=!1})},onApplyPromocode(){this.loading_apply=!0;const o={cart_uuid:s.getStorage("cart_uuid"),promo_code:this.promo_code};s.applyPromoCode(o).then(t=>{this.show_modal=!1,this.promo_code="",this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterApplypromo")}).catch(t=>{s.notify("dark",t,"error",this.$q)}).then(t=>{this.loading_apply=!1})}}},N={class:"row items-center q-col-gutter-sm"},R={class:"col b"},j={class:"col-4"},x={class:"text-weight-bold q-ma-none q-pt-md"};function E(o,t,l,b,i,p){return c(),_(I,{modelValue:i.show_modal,"onUpdate:modelValue":t[2]||(t[2]=r=>i.show_modal=r),position:"bottom"},{default:a(()=>[e(B,null,{default:a(()=>[e(L,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:a(()=>[e(P,{class:w(["text-weight-bold",{"text-white":o.$q.dark.mode,"text-dark":!o.$q.dark.mode}])},{default:a(()=>[m(d(o.$t("Add a promo")),1)]),_:1},8,["class"]),e(k),e(u,{onClick:t[0]||(t[0]=r=>i.show_modal=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),e(Q,null,{default:a(()=>[e(T,{onSubmit:p.onApplyPromocode},{default:a(()=>[n("div",N,[n("div",R,[e(v,{modelValue:i.promo_code,"onUpdate:modelValue":t[1]||(t[1]=r=>i.promo_code=r),label:o.$t("Enter promo code"),outlined:"","lazy-rules":"","bg-color":o.$q.dark.mode?"grey600":"input","label-color":o.$q.dark.mode?"grey300":"grey",borderless:"",class:"input-borderless"},null,8,["modelValue","label","bg-color","label-color"])]),n("div",j,[e(u,{loading:i.loading_apply,type:"submit",unelevated:"",color:"primary","text-color":"white","no-caps":"",class:"full-width",label:o.$t("Apply"),size:"lg"},null,8,["loading","label"])])])]),_:1},8,["onSubmit"]),n("h6",x,d(o.$t("Available promotions")),1)]),_:1}),e(U,{separator:""},{default:a(()=>[(c(!0),q(z,null,$(b.PromoStore.data[l.merchant_id],r=>C((c(),_(A,{key:r.promo_id,clickable:"",class:"q-mb-sm",onClick:f(y=>p.usePromo(r),["stop"])},{default:a(()=>[e(g,null,{default:a(()=>[e(h,null,{default:a(()=>[m(d(r.title),1)]),_:2},1024),e(h,{caption:"",class:"font11"},{default:a(()=>[m(d(r.sub_title),1)]),_:2},1024),e(h,{caption:"",class:"font11"},{default:a(()=>[m(d(r.valid_to),1)]),_:2},1024)]),_:2},1024),e(g,{side:""},{default:a(()=>[e(u,{onClick:f(y=>p.usePromo(r),["stop"]),loading:i.loading,flat:"",color:o.$q.dark.mode?"secondary":"blue","no-caps":"",label:o.$t("Use now"),dense:"",size:"md"},null,8,["onClick","loading","color","label"])]),_:2},1024)]),_:2},1032,["onClick"])),[[V]])),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Y=S(F,[["render",E]]);export{Y as default};
