import{_ as k,n as o,a1 as p,q as h,R as _,k as s,u as n,a8 as y,F as b,U as m,Q as l,ad as v,V as c,ab as u,t as q,aa as x,bE as V}from"./index.f4219e68.js";import{Q as $}from"./QToolbar.9e0c5c2c.js";import{Q as w}from"./QHeader.93fda4a5.js";import{Q as f}from"./QSpace.ac683136.js";import{Q as C}from"./QForm.bd9e2742.js";import{Q as S}from"./QPage.11bfb4d0.js";import{u as Q}from"./ClientStore.ec7cad84.js";import"./QResizeObserver.8f0e5734.js";const T={name:"VerifyAccount",data(){return{loading:!1,code1:"",code2:"",code3:"",code4:"",client_uuid:"",sent_message:"",code:"",counter:5,timer:void 0,settings:[],data:[],signup_resend_counter:5}},setup(){return{ClientStore:Q()}},watch:{counter(e,t){e<=0&&this.stopTimer()},code1(e,t){o.empty(e)?this.$refs.code1.focus():this.$refs.code2.focus()},code2(e,t){o.empty(e)?this.$refs.code1.focus():this.$refs.code3.focus()},code3(e,t){o.empty(e)?this.$refs.code2.focus():this.$refs.code4.focus()},code4(e,t){o.empty(e)?this.$refs.code3.focus():this.$refs.code4.focus()}},mounted(){this.$refs.code1.focus(),this.startTimer(),this.getAccountStatus(),this.client_uuid=this.$route.query.uuid},methods:{getAccountStatus(){this.loading=!0,o.getAccountStatus(this.$route.query.uuid).then(e=>{this.sent_message=e.msg,this.data=e.details.data,this.settings=e.details.settings,this.counter=e.details.settings.signup_resend_counter,this.signup_resend_counter=this.counter}).catch(e=>{o.notify("dark",e,"error",this.$q)}).then(e=>{this.loading=!1})},onSubmit(){let e=!0;this.settings.enabled_verification==="1"&&this.data.social_strategy==="google"&&(e=!1),this.settings.enabled_verification==="1"&&this.data.social_strategy==="facebook"&&(e=!1);const t={auto_login:e,client_uuid:this.$route.query.uuid,verification_code:this.code1+this.code2+this.code3+this.code4,local_id:o.getStorage("local_id")};this.loading=!0,o.verifyCodeSignup(t).then(a=>{if(e){p.setUser(a.details.user_data),p.setToken(a.details.user_token),this.ClientStore.user_settings=a.details.user_settings;const d=o.getStorage("place_id");console.debug("=>"+d),typeof d!="undefined"&&d!==null?this.$router.push("/home"):this.$router.push("/location")}else this.$router.push({path:"/account/complete-registration",query:{uuid:this.$route.query.uuid}})}).catch(a=>{o.notify("dark",a,"error",this.$q)}).then(a=>{this.loading=!1})},startTimer(){this.stopTimer(),this.timer=setInterval(()=>{this.counter--},1e3)},stopTimer(){clearInterval(this.timer)},resendCode(){o.requestCode(this.client_uuid).then(e=>{this.counter=this.signup_resend_counter,this.startTimer(),o.notify("green",e.msg,"check",this.$q)}).catch(e=>{o.notify("dark",e,"error",this.$q)}).then(e=>{})}}},A={class:"full-width"},U={class:"text-center"},B={class:"w-75 margin-auto"},I={class:"line-normal text-left"},N={class:"row items-center q-col-gutter-md"},F={class:"col"},R={class:"col"},z={class:"col"},E={class:"col"},P={key:1,class:"q-ma-none no-margin"};function D(e,t,a,d,i,g){return h(),_(b,null,[s(w,{class:y({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-black":!e.$q.dark.mode})},{default:n(()=>[s($,null,{default:n(()=>[s(m,{to:"/user/login",flat:"",round:"",dense:"",icon:"arrow_back",class:"q-mr-sm",color:e.$q.dark.mode?"white":"dark"},null,8,["color"])]),_:1})]),_:1},8,["class"]),s(S,{class:"flex flex-center"},{default:n(()=>[l("div",A,[s(v,{flat:""},{default:n(()=>[l("div",U,[s(C,{onSubmit:g.onSubmit,class:"q-gutter-md"},{default:n(()=>[l("div",B,[l("p",I,c(i.sent_message),1),l("div",N,[l("div",F,[s(u,{modelValue:i.code1,"onUpdate:modelValue":t[0]||(t[0]=r=>i.code1=r),ref:"code1",outlined:"",mask:"#","input-class":"text-center text-h5 text-weight-bold"},null,8,["modelValue"])]),l("div",R,[s(u,{modelValue:i.code2,"onUpdate:modelValue":t[1]||(t[1]=r=>i.code2=r),ref:"code2",mask:"#",outlined:"","input-class":"text-center text-h5 text-weight-bold"},null,8,["modelValue"])]),l("div",z,[s(u,{modelValue:i.code3,"onUpdate:modelValue":t[2]||(t[2]=r=>i.code3=r),ref:"code3",mask:"#",outlined:"","input-class":"text-center text-h5 text-weight-bold"},null,8,["modelValue"])]),l("div",E,[s(u,{modelValue:i.code4,"onUpdate:modelValue":t[3]||(t[3]=r=>i.code4=r),ref:"code4",mask:"#",outlined:"","input-class":"text-center text-h5 text-weight-bold"},null,8,["modelValue"])])]),s(f,{class:"q-pa-sm"}),i.counter===0?(h(),q(m,{key:0,onClick:g.resendCode,dense:"","no-caps":"",flat:"","text-color":"text=dark"},{default:n(()=>[x(c(e.$t("Resend Code")),1)]),_:1},8,["onClick"])):(h(),_("p",P,[l("u",null,c(e.$t("Resend Code in"))+" "+c(i.counter),1)])),s(f,{class:"q-pa-sm"}),s(V,{vertical:"",align:"center"},{default:n(()=>[s(m,{type:"submit",label:e.$t("Verify Now"),unelevated:"",color:"primary","text-color":"white",class:"full-width text-weight-bold",loading:i.loading,size:"lg","no-caps":""},null,8,["label","loading"])]),_:1}),s(f,{class:"q-pa-md"})])]),_:1},8,["onSubmit"])])]),_:1})])]),_:1})],64)}var W=k(T,[["render",D]]);export{W as default};
